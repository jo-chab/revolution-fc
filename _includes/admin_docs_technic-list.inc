<?php    if (isset($_GET['subcategory'])) {        $subcategoryUrl = $_GET['subcategory'];    }        $database = "DOCS_technic";?><script>    function setSelectedOption(selectId, value) {        var select = document.getElementById(selectId);        for (var i = 0; i < select.options.length; i++) {            if (select.options[i].value === value) {                select.options[i].selected = true;            } else {                select.options[i].selected = false; // Deselect other options            }        }    }    function filterSubcategories(selectedCategory) {        var selectedSubcategory = document.getElementById("subcategory_filter").value;        var currentUrl = window.location.href;        var urlParams = new URLSearchParams(window.location.search);        urlParams.set('category', selectedCategory);        urlParams.set('subcategory', selectedSubcategory);        window.location.href = currentUrl.split('?')[0] + '?' + urlParams.toString();        setSelectedOption("subcategory_select", selectedSubcategory); // Set selected subcategory option    }</script><div class="dashboard-main">    <div class="dashboard-title">        <h4>Liste des documents technique</h4>    </div>    <div class="dashboard-content">                <div class="d-form-cta header">            <div class="btn-primary small btn-add icon mobile-icon-only i-more js-content-add"><span>Ajouter un document</span></div>        </div>                <div class="content-add">            <form method="post" action="action_doc_technic_add" enctype="multipart/form-data">                <div class="d-form-wrapper">                                        <input name="db-name" type="hidden" value="<?php echo $database ?>">                                        <div class="grid-layout-2">                        <div class="form-row column">                            <div id="select-subcategory" class="select-dropdown">                                <label>Sélectionner une catégorie</label>                                <select name="subcategory_select" id="subcategory_select">                                    <?php                                        // Execute the statement to fetch subcategory data                                        $stmtFilterCat = $db->prepare("SELECT * FROM DOCS_technic_category, DOCS_technic_subcategory WHERE reference_category = id_category ORDER BY id_subcategory ASC");                                        $stmtFilterCat->execute(); // Execute the statement                                                                                echo "<option value='0'>Toutes les categories</option>";                                        while ($result = $stmtFilterCat->fetch(PDO::FETCH_ASSOC)) {                                            $category = nl2br(stripslashes($result['category_name']));                                            $subcategory = nl2br(stripslashes($result['subcategory_name']));                                            $idSubcategory = $result['id_subcategory'];                                            $isSelected = ($idSubcategory == $subcategoryUrl) ? 'selected' : '';                                            echo "<option value='$idSubcategory' $isSelected>$category – $subcategory</option>";                                        }                                    ?>                                </select>                            </div>                        </div>                    </div>                                        <div class="form-row column">                        <label>Titre du document (max : 80 caractères)</label>                        <input id="news_title" name="zt_title" type="text" maxlength="256" required>                    </div>                                        <div class="dashboard-file-box">                        <input type="file" name="f_document" id="f_document" class="inputfile"/>                        <label for="f_document" class="upload-file-btn"><span>T&eacute;l&eacute;charger le fichier</span></label>                    </div>                    <script src="/js/custom-file-input.js"></script>                                </div>                <div class="d-form-cta">                    <div class="btn-primary small btn-confirm icon mobile-icon-only"><span>Enregistrer</span></div>                </div>                        </form>        </div>                        <div class="grid-layout-2">            <div class="form-row column">                <div id="filter-subcategory" class="select-dropdown">                    <label>Sélectionner une catégorie</label>                    <select name="subcategory_filter" id="subcategory_filter" onchange="filterSubcategories('<?php echo isset($categoryUrl) ? $categoryUrl : ''; ?>', this.value);">                        <?php                            // Execute the statement to fetch subcategory data                            $stmtFilterCat = $db->prepare("SELECT * FROM DOCS_technic_category, DOCS_technic_subcategory WHERE reference_category = id_category ORDER BY id_subcategory ASC");                            $stmtFilterCat->execute(); // Execute the statement                                                        echo "<option value='0'>Toutes les sous-categories</option>";                            while ($result = $stmtFilterCat->fetch(PDO::FETCH_ASSOC)) {                                $category = nl2br(stripslashes($result['category_name']));                                $subcategory = nl2br(stripslashes($result['subcategory_name']));                                $idSubcategory = $result['id_subcategory'];                                $isSelected = ($idSubcategory == $subcategoryUrl) ? 'selected' : '';                                echo "<option value='$idSubcategory' $isSelected>$category – $subcategory</option>";                            }                        ?>                    </select>                </div>            </div>                </div>                <ul class="dashboard-list" id="results" style="margin-top: 40px;">            <?php                $subcategory = isset($_GET['subcategory']) ? $_GET['subcategory'] : null;                                if (empty($subcategory)) {                    $stmt = $db->prepare("SELECT * FROM $database ORDER BY doc_title ASC");                    $stmt->execute();                } else {                    $stmt = $db->prepare("SELECT * FROM $database WHERE doc_subcategory = ? ORDER BY doc_title ASC");                    $stmt->execute([$subcategory]);                }                                $results = $stmt->fetchAll(PDO::FETCH_ASSOC);                foreach ($results as $result) {                    $doc = $result['id_doc'];                    $title = nl2br(stripslashes($result['doc_title']));                    $link = $result['doc_link'];                    $category = $result['doc_category'];                                        echo "                    <li class='dashboard-list-elements layout-col-3'>                        <div class='list-cta content-icon'>                            <form action='action_doc_delete' method='post'>                                <input type='hidden' name='element' value='$doc'>                                <input type='hidden' name='db-name' value='$database'>                                <input type='hidden' name='page' value='36'>                                <div class='btn-tertiary btn-text small btn-delete icon'></div>                            </form>                        </div>                        <div class='element-title content-element'>$title</div>                        <div class='list-cta content-btn'>                            <div>                                <form action='?p=36' method='post'>                                    <input type='hidden' name='element' value='$doc'>                                    <input type='hidden' name='db-name' value='$database'>                                    <div class='btn-primary small btn-update icon'><span>Modifier</span></div>                                </form>                            </div>                        </div>                    </li>";                }            ?>                        </ul>        </div></div><script>    // Function to update the results list based on category and subcategory    function updateResults() {        var selectedCategory = document.getElementById("category_select").value;        var selectedSubcategory = document.getElementById("subcategory_select").value;        // Make an AJAX request to fetch the updated data        var xhr = new XMLHttpRequest();        xhr.open("GET", "get_results.php?category=" + selectedCategory + "&subcategory=" + selectedSubcategory, true);        xhr.onreadystatechange = function () {            if (xhr.readyState === 4 && xhr.status === 200) {                // Update the content of the results element with the new data                document.getElementById("results").innerHTML = xhr.responseText;            }        };        xhr.send();    }    // Attach the updateResults function to the category and subcategory select elements    document.getElementById("category_select").addEventListener("change", updateResults);    document.getElementById("subcategory_select").addEventListener("change", updateResults);    // Call updateResults initially to populate the list based on the initial selections    updateResults();</script>
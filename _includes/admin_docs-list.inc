<?php	if(isset($_GET['category']))	{		$categoryUrl=$_GET['category'];	}	if(isset($_GET['subcategory']))	{		$subcategoryUrl=$_GET['subcategory'];	}        $database = "DOCS_club";    ?><script>    function setSelectedOption(selectId, value) {        var select = document.getElementById(selectId);        for (var i = 0; i < select.options.length; i++) {            if (select.options[i].value === value) {                select.options[i].selected = true;            } else {                select.options[i].selected = false; // Deselect other options            }        }    }    function filterCategories() {        var selectedCategory = document.getElementById("category_select").value;        var currentUrl = window.location.href;        var urlParams = new URLSearchParams(window.location.search);        urlParams.set('category', selectedCategory);        window.location.href = currentUrl.split('?')[0] + '?' + urlParams.toString();        setSelectedOption("category_select", selectedCategory);    }    function filterSubcategories(selectedCategory) {        var selectedSubcategory = document.getElementById("subcategory_select").value;        var currentUrl = window.location.href;        var urlParams = new URLSearchParams(window.location.search);        urlParams.set('category', selectedCategory);        urlParams.set('subcategory', selectedSubcategory);        window.location.href = currentUrl.split('?')[0] + '?' + urlParams.toString();        setSelectedOption("subcategory_select", selectedSubcategory); // Set selected subcategory option    }</script>        <div class="dashboard-main">            <div class="dashboard-title">                <h4>Gestion des documents <?php echo $database ?></h4>            </div>            <div class="dashboard-content">                                <div class="btn-primary cta-add icon mobile-icon-only i-more-2 " href="?p=30&db=<?php echo $database ?>"><span>Ajouter un document</span></div>                <div class="grid-layout-2">					<div id="filter-category" class="form-row column">						<label>Sélectionner une catégorie</label>						<div class="select-dropdown">                                                        <select name="category_select" id="category_select" onchange="filterCategories();">							<?php                                echo "<option value='0'>Toutes les catégories</option>";                                $stmt = $db->prepare("SELECT * FROM DOCS_category ORDER BY id_category ASC");                                $stmt->execute();                                $results = $stmt->fetchAll(PDO::FETCH_ASSOC);                                foreach ($results as $result) {                                    $category = nl2br(stripslashes($result['category_name']));                                    $id_category = $result['id_category'];                                    $option = ($id_category == $categoryUrl) ? "selected" : "";                                    echo "<option value='$id_category' $option>$category</option>";                                }							?>							</select>						</div>					</div>                    <div class="form-row column">                        <label>Sélectionner une sous-catégorie</label>                        <div id="filter-subcategory" class="select-dropdown">                            <select name="subcategory_select" id="subcategory_select" onchange="filterSubcategories('<?php echo isset($categoryUrl) ? $categoryUrl : ''; ?>', this.value);">                                <?php                                    // Get the selected category from the URL                                    $selectedCategory = isset($categoryUrl) ? $categoryUrl : null;                                                                        if (empty($selectedCategory) || $selectedCategory == 0) {                                        $stmtFilterCat = $db->prepare("SELECT * FROM DOCS_subcategory");                                    } else {                                        $stmtFilterCat = $db->prepare("SELECT * FROM DOCS_subcategory WHERE reference_category = ?");                                    }                                    $stmtFilterCat->execute([$selectedCategory]);                                    $resultsCat = $stmtFilterCat->fetchAll(PDO::FETCH_ASSOC);                                                                        echo "<option value='0'>Toutes les sous-categories</option>";                                    foreach ($resultsCat as $result) {                                        $subcategory = nl2br(stripslashes($result['subcategory_name']));                                        $idSubcategory = $result['id_subcategory'];                                        $isSelected = ($idSubcategory == $subcategoryUrl) ? 'selected' : '';                                        echo "<option value='$idSubcategory' $isSelected>$subcategory</option>";                                    }                                ?>                            </select>                        </div>                    </div>                                </div>                                <ul class="dashboard-list" id="results" style="margin-top: 40px;">                    <?php                        // Include your database connection code here                                                // Check if category and subcategory parameters are set and not empty                        $category = isset($_GET['category']) ? $_GET['category'] : null;                        $subcategory = isset($_GET['subcategory']) ? $_GET['subcategory'] : null;                                                // Prepare and execute your database query based on category and subcategory                        // If both category and subcategory are empty, retrieve all results                        if (empty($subcategory)) {                            $stmt = $db->prepare("SELECT * FROM $database ORDER BY doc_title ASC");                            $stmt->execute();                        } else {                            $stmt = $db->prepare("SELECT * FROM $database WHERE doc_subcategory = ? ORDER BY doc_title ASC");                            $stmt->execute([$subcategory]);                        }                                                // Fetch and output the data as HTML for the results list                        $results = $stmt->fetchAll(PDO::FETCH_ASSOC);                        foreach ($results as $result) {                            $doc = $result['id_doc'];                            $title = nl2br(stripslashes($result['doc_title']));                            $link = $result['doc_link'];                            $category = $result['doc_category'];                                                        echo "                    <li class='dashboard-list-elements layout-delete'>                        <div class='list-cta content-delete'>                            <div>                                <form action='action_doc_delete' method='post'>                                    <input type='hidden' name='element' value='$doc'>                                    <input type='hidden' name='db-name' value='$database'>                                    <div class='btn-secondary btn-delete icon'></div>                                </form>                            </div>                        </div>                        <div class='element-title content-id'>$title</div>                        <div class='list-cta content-btn'>                            <div>                                <form action='?p=32' method='post'>                                    <input type='hidden' name='element' value='$doc'>                                    <input type='hidden' name='db-name' value='$database'>                                    <div class='btn-primary btn-update icon'><span>Modifier</span></div>                                </form>                            </div>                        </div>                    </li>";                        }                    ?>                                                </ul>			</div>					</div><script>    // Function to update the results list based on category and subcategory    function updateResults() {        var selectedCategory = document.getElementById("category_select").value;        var selectedSubcategory = document.getElementById("subcategory_select").value;                // Make an AJAX request to fetch the updated data        var xhr = new XMLHttpRequest();        xhr.open("GET", "get_results.php?category=" + selectedCategory + "&subcategory=" + selectedSubcategory, true);                xhr.onreadystatechange = function() {            if (xhr.readyState === 4 && xhr.status === 200) {                // Update the content of the results element with the new data                document.getElementById("results").innerHTML = xhr.responseText;            }        };                xhr.send();    }    // Attach the updateResults function to the category and subcategory select elements    document.getElementById("category_select").addEventListener("change", updateResults);    document.getElementById("subcategory_select").addEventListener("change", updateResults);    // Call updateResults initially to populate the list based on the initial selections    updateResults();</script>
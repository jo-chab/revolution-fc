<?php	include("../_includes/_revolutionfc.inc");		function post_captcha($user_response)	{		$fields_string = '';		$fields = array(			'secret' => '6Lc8qswcAAAAAMxTldJHIjvjJsxjLA7f_oSNZi6X',			'response' => $user_response		);        // Build POST request		foreach ($fields as $key => $value) {			$fields_string .= $key . '=' . $value . '&';		}		$fields_string = rtrim($fields_string, '&');		        // Initialize cURL session		$ch = curl_init();        // Set cURL options		curl_setopt($ch, CURLOPT_URL, 'https://www.google.com/recaptcha/api/siteverify');		curl_setopt($ch, CURLOPT_POST, count($fields));		curl_setopt($ch, CURLOPT_POSTFIELDS, $fields_string);		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);		        // Execute cURL session and get response		$result = curl_exec($ch);        // Close cURL session		curl_close($ch);				return json_decode($result, true);	}		// Verify reCAPTCHA	$captcha_response = $_POST['g-recaptcha-response'];	$captcha_result = post_captcha($captcha_response);		if (!$captcha_result['success']) {		// reCAPTCHA verification failed		header('Location: login.php?error=captcha');		exit();	}		// Validate and sanitize user inputs	$email = filter_var($_POST['zt_email'], FILTER_SANITIZE_EMAIL);	$pass1 = $_POST['zt_new_pass'];	$pass2 = $_POST['zt_new_pass_2'];	$prenom = filter_var($_POST['zt_fn'], FILTER_SANITIZE_STRING);	$nom = filter_var($_POST['zt_ln'], FILTER_SANITIZE_STRING);		// Check if the email is already in use	if (verif_email($db, $email) !== -1) {        header('Location: ' . $websiteUrl . 'admin/login?m=3');		exit();	}		// Check if passwords match	if ($pass1 !== $pass2) {        header('Location: ' . $websiteUrl . 'admin/login?m=4');		exit();	}		// Hash the password securely	$pass3 = password_hash($pass1, PASSWORD_BCRYPT);		// Generate a unique hash for email verification	$hash = md5(uniqid());		// Set initial user status as inactive (0) and type (1) - Adjust as needed	$actif = "0";	$type = "1";		$stmt2 = $db->prepare('INSERT INTO USERS (user_fn, user_ln, email, password, hash, actif, type) VALUES (?, ?, ?, ?, ?, ?, ?)');	$execute = $stmt2->execute([		$prenom,		$nom,		$email,		$pass3,		$hash,		$actif,		$type	]);		if ($execute) {		$stmt2->closeCursor();        envoi_email($email, $pass1, $hash, $prenom, $nom);        header('Location: ' . $websiteUrl . 'admin/login?m=1');	} else {        header('Location: ' . $websiteUrl . 'admin/login?m=4');	}		function verif_email($db, $email)	{		$stmt3 = $db->prepare("SELECT email FROM USERS WHERE email = ?");		$stmt3->execute([$email]);		$result = $stmt3->fetch(PDO::FETCH_ASSOC);		if ($result) {			return $result['email'];		} else {			return -1;		}	}		function envoi_email($param1, $param2, $param4, $param5, $param6)	{		$recipient="moustapha.sall@revolutionfc.ca";		$recipient2=$param1;		$fn=$param5;		$ln=$param6;		$subject = "Revolution FC - Nouvel utilisateur inscrit";		$subject2 = "Revolution FC - Confirmation inscription utilisateur";		$content = "							Un nouvel utilisateur s'est inscrit depuis votre site internet<br /><br />							Prenom : $prenom<br />							Nom : $nom<br />							Login : $param1<br />							<br /><br />N'oubliez pas definir son role dans la gestion des utilisateurs afin que cette personne puisse avoir au contenu du site en fonction de son role.				";		$content2 = "							Merci pour votre inscription depuis notre site Revolutionfc.ca<br />							Vous pourrez vous connecter sur le site après avoir cliqué sur le lien d'activation ci-dessous.<br />							<a href='https://www.revolutionfc.ca/verif.php?email=".$param3."&hash=".$param4."'>https://www.revolutionfc.ca/verif.php?email=$param3&hash=$param4</a>							Voici vos identifiants, nous vous recommandons de les garder précieusmeent.<br /><br />							Login : $param1<br />							Mot de passe : $param2<br />							Adresse courriel : $param3<br />				";		$headers =			"Content-type: text/html; charset=utf-8" . "\r\n" .			"From: jonathan@chabertdesign.com" . "\r\n" .			"Reply-To: jonathan@chabertdesign.com" . "\r\n" .			"X-Mailer: PHP/" . phpversion();				mail($recipient, $subject, $content, $headers);		mail($recipient2, $subject2, $content2, $headers);	}?>